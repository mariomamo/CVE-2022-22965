FROM tomcat:9.0.44

ADD config_files/tomcat-users.xml /usr/local/tomcat/conf/tomcat-users.xml
ADD config_files/context.xml /tmp/context.xml
ADD config_files/web.xml /tmp/web.xml
ADD vulnerable_app/target/spring4shell.war /usr/local/tomcat/webapps/spring4shell.war
ADD safe_app/target/safeapp.war /usr/local/tomcat/webapps/safeapp.war

EXPOSE 8080

CMD /bin/bash -c "mv /usr/local/tomcat/webapps.dist/* /usr/local/tomcat/webapps; cp /tmp/context.xml /usr/local/tomcat/webapps/manager/META-INF/context.xml; cp /tmp/web.xml /usr/local/tomcat/webapps/manager/WEB-INF/web.xml; catalina.sh run"