FROM tomcat:9.0.44

ADD docker/tomcat-users.xml /usr/local/tomcat/conf/tomcat-users.xml
ADD docker/context.xml /tmp/context.xml
ADD docker/web.xml /tmp/web.xml
ADD target/safeapp.war /usr/local/tomcat/webapps/safeapp.war

EXPOSE 8080

CMD /bin/bash -c "mv /usr/local/tomcat/webapps.dist/* /usr/local/tomcat/webapps; cp /tmp/context.xml /usr/local/tomcat/webapps/manager/META-INF/context.xml; cp /tmp/web.xml /usr/local/tomcat/webapps/manager/WEB-INF/web.xml; catalina.sh run"